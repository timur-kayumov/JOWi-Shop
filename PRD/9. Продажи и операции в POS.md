Продажи и операции в POS

(Этот раздел дополняет раздел о POS-клиенте, фокусируясь на процессах оформления продажи и связанных действиях.)

Продажа (чек): Основная транзакция – розничная продажа:

Кассир сканирует или выбирает товар, он добавляется в список чека с указанной ценой. По умолчанию цена берется из текущего прайс-листа (обычно розничная цена из каталога).

Кассир может изменять количество (например, если покупают 2 штуки одного товара). Если товар измеряется весом – интерфейс позволяет ввести вес вручную или получать от весов.

Применение скидок: кассир может выбрать позицию и ввести скидку (%) или сумму, если имеет право. Либо применить скидку на весь чек (например, по дисконтной карте – это делается автоматически через Jowi Club, или вручную по решению администратора).

Добавление клиента к продаже: Если покупатель предоставляет карту лояльности или просит накопить баллы, кассир вводит клиента в чек (поиск по номеру телефона, сканирование штрих-кода карты и т.д.). Система отображает имя клиента, его статус, доступные баллы/скидку. После этого продажи могут учитываться на этого клиента (для CRM аналитики) и применяться правила лояльности.

Итоги: По мере добавления позиций система считает итоги – промежуточный итог, скидки, налоги (если выделяются), итоговую сумму к оплате. Эти поля обновляются в реальном времени и видны кассиру.

Когда клиент готов оплатить, кассир нажимает «Оплата» и выбирает способ оплаты (или несколько, если частями).

Фискализация: После подтверждения оплаты чек отправляется на фискальный принтер для регистрации
moysklad.uz
. Кассиру отображается состояние (успех/ошибка). В случае ошибки фискализации – система должна выдать понятное сообщение (например, «Ошибка связи с кассой»), предложить повторить. В оффлайн-режиме, если фискальный аппарат не подключен к интернету, чек всё равно печатается (с отметкой офлайн, если таковое разрешено законодательством), и данные отправляются когда связь появится.

Печать чека: POS печатает клиентский чек (ширина ~58-80 мм, моноширинный шрифт, 48 символов в строке). В чеке – наименование магазина, адрес, ИНН, дата-время, список товаров (название, кол-во, цена, сумма, налог), итог, сумма НДС (если есть), скидка отдельной строкой, QR-код, фискальные реквизиты (номер фискального документа, заводской номер кассы и пр.). Чек печатается на локальном принтере сразу же после проведения.

Хранение данных продажи: Продажа сохраняется локально (в SQLite) сразу при проведении, присваивается временный ID. Если интернет есть – отправляется на сервер и получает облачный ID. Если интернета нет – ждет в очереди отправки.

Возврат товара (refund): Необходим механизм оформления возврата:

Возврат может осуществляться по чеку: кассир находит оригинальный чек (через поиск по номеру, дате или сканированию QR-кода чека, если наш), затем выбирает позиции и количество к возврату. Система создаёт отрицательную транзакцию с пометкой «Возврат», и также отправляет её на фискальный регистратор как чек возврата
moysklad.uz
.

Если оригинальный чек не найден (например, утерян или система его не находит – хотя если чек выбит в системе, он должен быть), то возврат можно оформить вручную через отдельный документ «Возврат без чека» – кассир сканирует товар, указывает количество к возврату, возможна причина возврата. Такой возврат тоже фискализируется (отдельный тип).

При возврате происходит приход товара на склад (то есть увеличение остатка) и возврат денег покупателю (наличными или отмена транзакции по карте на терминале). Финансово – уменьшается выручка, корректируется прибыль.

Учитывать ограничения законодательства (например, возврат в тот же день может аннулировать продажу, а возврат после смены – отдельной транзакцией). Разрешить частичный возврат.

Отмена продажи: Если кассир начал пробивать чек, но покупатель передумал до оплаты, достаточно нажать «Отмена» – текущий чек просто очищается (не сохраняется). Если же чек уже оплачен/напечатан, его отмена возможна только через возврат.

Открытие/закрытие смены:

Открытие смены: При начале работы кассир (или старший) должен открыть кассовую смену на терминале. Вводится начальный остаток наличности в кассе (сколько денег было в ящике на начало дня). Смена открывается через команду фискальному регистратору (открытие фискальной смены) и фиксируется в системе (создается объект «Смена» с меткой времени и ответственным).

Закрытие смены: В конце дня (или при пересменке) кассир выполняет закрытие смены. Система должна напечатать Z-отчёт – итоговый отчет по смене (количество чеков, сумму наличных, сумму безналичных, возвраты, итого выручка, суммы налогов). Фискально – происходит закрытие смены на кассе. В системе сохраняется запись с итогами.

При закрытии смены кассир подсчитывает фактические деньги в ящике и вводит сумму. Система сравнивает с ожидаемым остатком по данным (начальный + продажи - возвраты - внесения + изъятия) и показывает разницу (излишек/недостача). Это сохраняется в отчёте.

Без закрытия предыдущей смены невозможно открыть новую (контролируется).

Управление наличностью в течение дня:

Внесение денег: Операция, когда в кассу кладут наличные (например, размен, либо инкассация – хотя инкассация скорее изъятие). Кассир выбирает «Внесение», вводит сумму, и эта сумма добавляется к кассе (не является выручкой, а просто увеличивает наличные).

Изъятие денег: Операция выемки из кассы (например, передают деньги в офис или инкассаторам). Указывается сумма, причина. Эта сумма вычитается из остатков кассы. В Z-отчёте такие операции должны учитываться отдельно.

Эти операции не фискализируются как чеки продажи, но могут требовать просто записи в журнал. Однако для полноты учёта кассы они важны.

Несколько типов продаж: Пока ориентируемся на розничную продажу со 100% оплатой. Продажи с отсрочкой платежа, счетами и т.п. – не в MVP (это больше B2B функция). В будущем можно добавить счёт на оплату (invoice) и продажу в кредит (для постоянных оптовых клиентов), но сейчас нет.

Удобство для кассира:

Интуитивность: Процесс продажи должен быть обучаем «с нуля» за 10-15 минут. Конкуренты заявляют «старт за 15 минут»
moysklad.uz
 – у нас аналогично: понятные кнопки, подсказки на экране («Отсканируйте или введите код товара»).

Минимум ошибок: Система предупреждает о нетипичных ситуациях: продажа без открытия смены, попытка продать товар при нулевом остатке, повторное сканирование одного товара (возможно, просто увеличивает количество, что правильно), превышение допустимой скидки.

Скорость: Время от начала пробития чека до печати – ключевой показатель. Будем стремиться оптимизировать поиск товаров (быстрые запросы к локальной БД), рендеринг списка (виртуализация для длинных чеков), и задержку печати (быстрый драйвер печати, параллельная отправка на фискализацию).

Обучение: При первом запуске POS можно отобразить режим обучения/демо: подсветка основных кнопок, краткая инструкция (например, интерактивный туториал, который можно пропустить).

Продажи через другие каналы: В MVP фокус на офлайн-магазине. Продажи через интернет-магазин или маркетплейс будут учитывать как интеграции (см. раздел Интеграции), но сам процесс оформления интернет-заказа вне системы (поступает уже как готовый заказ, возможно, мы его проводим как отдельный тип документа)