Интеграции внешние

Программа лояльности – JOWi Club: (См. Ценообразование и скидки раздел) – основная интеграция MVP. Все аспекты работы с бонусными баллами и картами лояльности выполняются через REST API Jowi Club:

Необходимо настроить безопасное соединение (API key или OAuth) между нашим приложением и Jowi Club.

Обработать вебхуки от Jowi (например, если клиент проверяет баланс через приложение – не критично для нас, или если нужно уведомление о начислении).

Отказоустойчивость: Если Jowi Club недоступен, кассир всё равно должен иметь возможность пробивать чеки (просто без применения скидки, либо с резервным офлайн-режимом лояльности – это сложно, скорее, просто предупреждение).

Маркетплейсы / e-commerce: В MVP не реализуем, но закладываем возможность:

Создаём абстракцию или модуль Integration Hub, куда можно добавлять коннекторы к внешним системам. Например, коннектор к Uzum Market, Wildberries, Ozon и т.д. (MoySklad уже имеет готовые интеграции с Uzum и WB
moysklad.uz
).

В будущем это позволит пользователям синхронизировать товарный остаток с онлайн-площадками, выгружать товары на маркетплейсы, загружать заказы.

Важное требование – архитектура API должна позволять безопасно обращаться к сторонним сервисам и хранить креденшлы (например, токены API маркетплейсов).

В MVP ограничимся проектированием интерфейсов: например, таблица integration с полями type (marketplace name) и токенами, базовые endpoints.

Онлайн-магазин: Если клиенты захотят собственный интернет-магазин, возможны пути:

Предоставить простой встроенный онлайн-витрину (как делает BILLZ – у них, видимо, есть e-commerce модуль
tbcbankgroup.com
). Это вне MVP – требует фронтенд магазин, корзину и т.п.

Либо интегрироваться с популярными CMS (WooCommerce, Shopify) – тоже позже.

На уровне MVP можно только отметить, что заказы из интернет-каналов можно будет ручным импортом оформлять (менеджер получил заказ – руками завёл в систему как расходную накладную на клиента).

Платёжные сервисы: В перспективе:

Payme, Click – локальные платёжные системы. MoySklad, например, упоминает регистрацию продаж через QR-коды Click/Payme
moysklad.uz
. Мы можем интегрироваться с их API, чтобы генерировать QR для оплаты и получать подтверждение платежа. В MVP, скорее всего, не реализуем, но учитываем, что это желательная фича для рынка.

Банковские эквайринги – возможно, сотрудничество с Payme (который предоставляет терминалы) или TBC Bank (партнёры Billz) для интеграции. Пример: TBC Bank приобретает Billz, обещая интеграцию с банковскими сервисами (кредиты, эквайринг)
tbcbankgroup.com
. Наш продукт тоже может в будущем получить плюсы от партнерств с финтехом.

Национальные сервисы:

AslBelgisi – см. Маркировка выше. По сути, это внешняя система, куда надо посылать данные о маркированных товарах. Интегрируем через API (вероятно, REST или SOAP). Сложность – в требовании в реальном времени при продаже проверять код. Это учтём в POS (доп. шаг сканирования марки).

Электронные счета-фактуры (E-SF): Если для оптовых или B2B продаж понадобится выписывать счет-фактуры и отправлять их в налоговую электронно, можно подумать об интеграции с системами вроде Didox (электронный документооборот) – MoySklad уже анонсировал такое
moysklad.uz
. Но для чисто розницы (B2C) это не нужно. Поэтому MVP без этого.

Фискальные регистраторы: (Повторим) – интеграция с оборудованием выносится в отдельный сервис fiscal-gateway. Для реализации драйверов под разных производителей (Штрих-М, Атол, HCP и др. – какие доступны в Узбекистане). С POS и бэкенда общение с этим сервисом через HTTP или gRPC – т.е. POS отправляет JSON команду registerSale → fiscal-gateway → принтер, получает ответ. Такой подход упростит сертификацию и поддержку (можно обновлять драйверы отдельно).

Мобильное приложение: В MVP мобильных клиентов нет. Но, возможно, интеграция с мобильным приложением Jowi (если у них есть клиентское приложение или приложение для владельцев). Например, получение push-уведомлений о выручке за день. Но конкретных требований нет, поэтому просто имеем ввиду, что REST API нашего сервера должен позволять реализовать mobile app в будущем.

API для клиентов: Некоторым продвинутым пользователям может понадобиться API для их внутренних систем. Планируем после MVP опубликовать API (на основе тех же tRPC контрактов) для основных операций: получить остатки, создать продажу (например, если они свою кассу хотят прикрутить). В MVP — не приоритет, но архитектура (NestJS + tRPC-like) фактически уже предоставляет API, нужно будет лишь документировать.

Шина событий: За кулисами NATS может использоваться для трансляции событий (продан товар – событие, которое может слушать модуль интеграции). Это внутренняя архитектурная деталь, чтобы новые интеграции добавлялись подпиской на события, а не переписыванием логики продаж