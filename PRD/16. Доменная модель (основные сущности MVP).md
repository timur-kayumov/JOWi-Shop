Доменная модель (основные сущности MVP)

Для ясности, приведём ключевые сущности предметной области и их взаимоотношения:

Бизнес (Business) – компания-клиент SaaS. Атрибуты: название, ИНН/ОГРН, юридические данные, тариф (если коммерческая модель), настройки (валюта, язык по умолчанию и т.п.). Связан со множеством пользователей и магазинов.

Магазин (Store/Outlet) – торговая точка. Атрибуты: название/адрес, привязка к бизнесу. Может иметь собственные настройки (например, отдельный префикс нумерации чеков). Один бизнес имеет несколько магазинов.

Терминал/Касса (POS Terminal) – конкретное рабочее место. Атрибуты: идентификатор (может быть серийный номер устройства или логическое имя), привязка к магазину. Нужен для учёта смен и идентификации, с какого устройства пришёл чек. Один магазин может иметь несколько терминалов.

Пользователь / Сотрудник (User/Employee) – учетная запись человека. Атрибуты: имя, email/телефон (для логина), пароль (хэш), роль, активность, возможно ссылка на сотрудника (вне системы). Может быть привязан к определённому магазину (для кассира). Один пользователь принадлежит одному бизнесу (в MVP).

Роль (Role) – роль доступа, с набором разрешений. Фиксированные записи: Админ, Менеджер, Кассир, Склад. Связь многие-ко-многим: пользователь может иметь одну роль (или несколько, но в MVP достаточно одну основную).

Смена (Shift) – кассовая смена. Атрибуты: номер смены, терминал, открыт кем/когда, закрыт кем/когда, начальная сумма, конечная сумма, рассчитанная выручка, фактическая выручка, отклонение, статус (открыта/закрыта). Связана с терминалом и, через него, с магазином и бизнесом.

Клиент / Покупатель (Customer) – контрагент типа "покупатель". В рознице часто не идентифицируется, но для лояльности и CRM мы храним базу клиентов. Атрибуты: имя, телефон, email, возможно номер карты лояльности, ссылка на внешнюю систему (ID в Jowi Club). Можно хранить дату рождения, пол (для акций), адрес (если доставки).

Поставщик (Supplier) – контрагент типа "поставщик". Нужен для приходов и расчетов. Атрибуты: название, контактные данные, ИНН. Баланс с поставщиком – расчетный на основе документов.

Товар (Product) – товарная номенклатура (родитель для вариантов). Атрибуты: название, артикул (если есть общий), категория, бренд, единица измерения по умолчанию, налог (ставка налога), активен/неактивен.

Вариант товара / SKU (ProductVariant) – конкретная разновидность товара. Если товар без вариантов, все равно создаётся один вариант “по умолчанию”. Атрибуты: собственный код/SKU, связанный товар, значения атрибутов варианта (например, цвет=красный, размер=L), штрих-код (основной), вес (для весового товара, может хранить штучный вес?), цена закупки последняя (для справки), и пр.

Штрих-код (Barcode) – отдельная сущность или просто поле списка в SKU. Наверное, можно как отдельную сущность, связанную со SKU, чтобы хранить несколько. Атрибуты: код, тип кода (EAN13, Code128 и т.д.), основной признак.

Категория (Category) – категория/группа товаров (дерево). Атрибуты: название, родительская категория (для иерархии), признак типа (вдруг отделяем услуги или еще что, но пока нет).

Склад (Warehouse) – место хранения. В MVP, фактически один склад = один магазин, но сущность все равно нужна. Атрибуты: название, магазин, тип (магазин, центральный склад и т.д.). Используется в остатках и движениях.

Остаток (Stock) – текущий остаток товара на складе. Атрибуты: склад, SKU, количество, стоимость (средняя или суммарная? Можно не хранить, а вычислять). Можно организовать как Materialized View на основе движений, но, скорее, обновлять при каждой транзакции для быстрого доступа. Важна целостность – не потерять изменения при параллельных операциях.

Партия (Batch/Lot) – партия товара. Атрибуты: SKU, склад, уникальный ID партии, количество в партии (текущее), закупочная цена, дата поступления, возможно срок годности. Новая партия создаётся приходом. При продаже списывается из первой по очереди.

Документ движения (InventoryDocument) – абстрактная сущность для складских операций (приход, перемещение, инвентаризация и т.п.). Общие атрибуты: тип документа, дата, склад-отправитель (для перемещения), склад-получатель, контрагент (для приходов/возвратов), статус (черновик/проведен), комментарий.

Строка документа (DocumentLine) – строка товара в документе: SKU, количество, цена (для приходов – закупочная, для перемещений можно 0 или тоже цена для оценки).

Конкретные документы могут иметь специфические поля: для инвентаризации – кол-во по учёту и кол-во фактическое, для списания – причина и т.п.

Чек (SaleReceipt) – документ продажи (розничный чек). Атрибуты: уникальный номер (может быть составной: номер смены + порядковый, или глобальный), дата-время, кассир (пользователь), клиент (если указали), магазин/терминал, итоги: сумма, скидка, налог, статус (пробит/возврат/аннулирован), ссылки на фискальные данные (номер фискального чека, фискальный признак).

Позиция чека (SaleItem) – строка в чеке: SKU, товар, количество, цена, сумма, скидка на строку, налог на строку (если нужен).

Оплата (Payment) – привязанная к чеку запись: тип оплаты (наличные, карта, баллы, сертификат и т.д.), сумма. Обычно чек состоит либо из одной оплаты на всю сумму, либо нескольких (split payment).

Связь с возвратом: если это чек возврата, может быть поле reference на оригинальный чек.

Скидка (Discount) – как отдельная сущность не требуется, т.к. скидка фиксируется как поле (процент или сумма) в SaleItem или SaleReceipt. Но если бы были купоны, можно хранить как сущность Promotion/DiscountCampaign. В MVP – не делаем, достаточно полей.

Кассовая операция (CashTransaction) – для внесений/изъятий. Атрибуты: дата, кассир, тип (внесение/изъятие), сумма, комментарий. Привязано к смене или магазину.

Проводка (LedgerEntry) – элемент бухгалтерской записи. Поля: дата, описание, счет Дт, счет Кт, сумма. Счета можно закодировать (например, 401 "Товары", 701 "Выручка"). Это для внутреннего учета, у пользователя интерфейса к этому может не быть (кроме фин. отчетов). Если не успеваем, можно опустить реализацию двойной записи, но упомянуть как базу для будущего.

Интеграция (IntegrationConfig) – хранит настройки интеграций для конкретного бизнеса:

Тип (JowiClub, конкретный маркетплейс, платежный сервис).

Поля аутентификации (API key, секрет).

Статус интеграции (активен/не активен).

Могут быть связанные сущности, напр. IntegrationLog (журнал обмена, чтобы отлаживать).

Логи и служебные:

AuditLog – запись аудита: кто, когда, что сделал (например, "User X deleted product Y" или "Price of product Z changed from A to B by User U").

SyncQueue – таблицы очередей Outbox/Inbox для оффлайн: список изменений (например, модель, ID, тип операции: insert/update/delete, payload).

Notification – если делаем всплывающие уведомления (не критично).

Settings – различные настройки бизнесов (например, включена ли продажа в минус, обязательна ли карта клиента для чека и т.п.). Может быть JSON поле.

(Эта модель охватывает основную информацию, необходимую для MVP. При разработке могут появиться дополнительные сущности или связи, но ключевые домены – продажа, товар, склад, деньги – описаны выше.)

17. Требования к UI/UX и дизайн-гайдлайны

(В этом разделе перечислены принципы дизайна интерфейса и опыт взаимодействия, чтобы продукт был удобным и единообразным.)

Единый дизайн-систем: Разработчики интерфейса придерживаются принципа, что код – единственный источник правды для дизайна. Используется единая библиотека компонентов @jowi/ui без макетов в Figma, то есть стиль оттачивается непосредственно в компонентах. Это обеспечивает единообразие и предсказуемость UI на всех экранах.

Цветовая схема и темы:

Используем CSS-переменные для цветов, шрифтов и т.д. Это позволяет легко менять тему. Изначально будет светлая тема (адаптированная под дневную работу) и тёмная тема (удобна для работы вечером или в слабо освещённых помещениях, напр. склад).

Цветовая палитра нейтральная, без кислотных цветов. Основной цвет (primary) – например, синий или зелёный, ассоциирующийся с брендом. Ошибка – красный, предупреждение – оранжевый/желтый, успешное – зелёный.

Важно соблюдать контраст ≥ 4.5:1 для текста на фоне
moysklad.uz
, чтобы интерфейс был читаем даже на не самых новых мониторах и для людей с небольшими нарушениями зрения.

Типографика:

Шрифты используем системные (для Windows – Segoe UI / для веб – sans-serif по умолчанию), чтобы не было проблем с загрузкой и чтобы текст выглядел привычно.

Размеры шрифта: базовый 14px для интерфейса (может 15px, чтобы чуть крупнее). Заголовки – 16-18px. На POS, возможно, делаем чуть крупнее (16px базово), учитывая расстояние до экрана.

Моноширинный шрифт – для печатных форм (чек), и возможно для каких-то таблиц (необязательно).

Сетка и отступы:

Интерфейс строится на 8pt grid. Все отступы, поля – кратны 8 (или 4 для мелких). Это придаёт визуальную гармонию.

Максимальная ширина контейнера для содержимого ~1200-1440px на широком экране. Этого достаточно для отображения таблиц и форм. На очень больших экранах контент центрируется в этой ширине, чтобы не «растягивался» (улучшается читаемость).

Адаптивность: Веб-админка должна корректно отображаться на ширине от ~1024px (планшет в горизонтали) и выше. На мобиле веб-админку можно не оптимизировать (мало кто будет пользоваться с телефона бэкендом), но страницы логина/отчётов можно хотя бы прокручивать.

Навигация и компоновка:

App Shell: Для веб – левое боковое меню (Sidebar) со списком основных разделов: Главная (дашборд), Товары, Склад, Продажи (или Чеки), Отчёты, Настройки, Пользователи, Интеграции (если нужно). Вверху – панель (Topbar) с названием текущего раздела, переключателем магазина (если админ хочет смотреть данные по конкретной точке), и меню пользователя (профиль, выход, язык).

В POS-приложении – можно обойтись без сложного меню: основной экран – это оформление продажи. Остальные функции (например, X-отчёт, возврат без чека, настройки оборудования) можно делать через меню, вызываемое по нажатию (например, клавиша F10 "Меню" или кнопка шестерёнки). POS интерфейс должен быть максимально сфокусирован на продаже, чтобы кассир не отвлекался.

Хлебные крошки: для веб-админки, если есть вложенные сущности (например, открыли карточку товара из списка) – можно отображать навигационную цепочку. Но часто достаточно просто модальных окон для редактирования.

Иконки: Используем набор lucide-react – современные векторные иконки. Размеры 16px внутри текста/кнопок, 20-24px для основных меню/иконок. Иконки с понятной метафорой для каждого раздела: товар – 🛒, склад – 📦, отчёты – 📊, настройки – ⚙️ и т.д. (Выберем из lucide близкие). Иконки добавляют визуальные подсказки пользователю.

Компоненты интерфейса:

Таблицы (DataTable): на страницах списков (товары, документы, отчёты) используем мощный табличный компонент на базе TanStack Table. Он поддерживает:

Серверную пагинацию (чтобы не загружать тысячи записей сразу).

Виртуализацию строк для производительности на больших списках.

Фильтры по колонкам (например, поиск по названию товара прямо в заголовке колонки).

Сортировку по колонкам.

Возможность скрывать/показывать колонки.

Кнопку экспорта данных в CSV (например, текущий фильтрованный список).

Выбор строк (чекбоксами) для пакетных операций (удалить, экспортировать выбранное и т.п.).

Формы (Form, FormField): Создан единый компонент Form с интеграцией React Hook Form + Zod. Это даёт:

Валидацию вводимых данных по схеме (например, цена должна быть ≥0, обязательные поля, формат email).

Отображение ошибок под соответствующим полем (FormField компонент выводит label, input, и если есть ошибка – текст ошибки).

Единый стиль для всех форм: расстояние между полями, поведение при фокусе, подсветка ошибок (красная рамка, например).

Поля ввода: текстовые, числовые (с форматированием), выпадающие списки (Select – на базе Radix Select), чекбоксы, переключатели, даты (DatePicker – можно использовать библиотеку или кастом).

Диалоги форм: Модальные окна с формой (например, создание нового товара, проведение оплаты) используют компонент FormDialog – он автоматически добавляет заголовок, кнопки "Сохранить/Отмена", блокирует закрытие по ESC при незаполненных обязательных, и т.д.

Мастер (Wizard): Для сложных процессов (например, первичная настройка или инвентаризация) можно применить компонент Wizard – последовательность шагов с «Далее/Назад». Это улучшает UX при множестве вводимых данных.

Диалоги и уведомления:

Dialog/Drawer: используем Radix Dialog для модальных окон и Radix Drawer для выезжающих панелей сбоку. Например, просмотр детали чека – как боковая панель, чтобы не переключаться на другую страницу.

Toast (уведомления): Компонент для всплывающих уведомлений (в правом верхнем углу, например). Используется для кратких сообщений: "Товар сохранен", "Ошибка: нет подключения" и т.п. Дизайн тостов единообразный, автоматически скрываются через несколько секунд.

Loading states: Компонент спиннера и скелетонов (серые мигающие блоки вместо еще не загруженного списка) – общий. Например, при загрузке таблицы товаров сначала показываем скелет-строки, потом данные.

Empty states: Если список пуст – отображаем дружелюбное сообщение с иконкой, объясняющее, что пока данных нет, и возможно CTA ("Добавить первый товар").

Error states: При ошибке загрузки – показываем сообщение об ошибке с возможностью повторить попытку (Retry).

Навигационные компоненты: Tabs (вкладки) – для страниц, где несколько под-разделов (например, на странице товара: «Общие», «Цены», «Остатки», «Изображения» как вкладки).

Карточки и графики: Для дашборда – компонент KPI-Card (отображает показатель и подпись, может быть стрелочка тренда). Графики – примитивы для BarChart, LineChart, PieChart, с Legend и Tooltip по умолчанию
moysklad.uz
.

Специфика POS UX:

Горячие клавиши: Ограничимся самыми нужными, но документируем их. Например: F1 – помощь/справка, F2 – поиск товара, F3 – переключить фокус на список чека, F4 – удалить выбранный товар из чека, F5 – применить скидку, F9 – оплата, F12 – закрыть смену (примерно, уточним).

Режим сканера: Когда кассир сканирует штрих-код, ввод фокусируется на скрытом поле ввода, которое ловит цифры, после Enter (сканер обычно посылает Enter) – система ищет товар. Если найден – добавляет в чек. Если не найден – сигнал ошибки (звуковой, визуальный) и предложение ввести код вручную или создать товар на лету (можно сразу добавить новый товар, если такая бизнес-логика разрешена).

Чек на экране: Отображается в виде списка строк с возможностью прокрутки. Последний добавленный товар выделяется на секунду (вспышка фона) для визуального подтверждения.

Крупные интерактивные элементы: Кнопки оплаты, отмены – большие и вынесены в понятные зоны. Цветовое кодирование: "Оплата/Завершить" – зелёная кнопка, "Отмена" – серая/красная, "Возврат" – оранжевая, например.

Состояние кассы: Где-то на экране POS небольшая панель: имя кассира, текущее время, статус связи (онлайн/оффлайн индикатор), и, возможно, сумма в кассе (но это спорно показывать кассиру постоянно). Главное – индикатор Offline Mode, чтобы кассир знал, что сейчас чек офлайн и синхрон. Это можно сделать иконкой (🌐 зеленая если онлайн, 🔴 если нет).

Печать чеков: После печати успешной – выдать сигнал (звук "дзинь"). Если печать провалилась – сигнал ошибки и всплывающее окно с инструкцией (например, "Проверьте подключение принтера. Повторить печать?").

Обучение кассира: Возможно, сделать раздел "Тренировка" – переключение в режим, где чеки не идут в учёт, а просто для обучения (как демонстрационный режим). Это опционально.

Адаптация под разные устройства:

POS предполагается на Windows ПК. Но Electron позволяет и Linux/Mac. Если клиенты попросят – можно будет дать.

Web Admin – желательно, чтобы работал и на планшете. Вдруг менеджер смотрит отчёты с iPad. Поэтому, тестируем на разрешении ~768px ширины (портретный планшет): сайдбар можно скрывать (гамбургер меню).

Мобильные телефоны: можно не оптимизировать админку. Но авторизация/просмотр отчёта в крайних случаях должна хотя бы не ломаться.

Accessibility (доступность):

Придерживаемся ARIA-меток и стандартов. Radix компоненты уже имеют хорошую поддержку клавиатуры и экранных читалок.

Все интерактивные элементы помечены tabindex правильно, последовательность табуляции логичная.

Focus rings: Не отключаем обводку фокуса для клавиатурной навигации. По дизайну: при фокусе элемент обводится синим или контрастным ободком, так пользователь понимает, где он находится, особенно при использовании Tab.

Текстовые альтернативы для иконок (aria-label) – добавляем на кнопках, где только иконка.

Контраст цветов, размер шрифта – уже упомянуто.

Сообщения и текст:

Текстовки интерфейса хранятся в i18n словарях. Они должны быть лаконичными и понятными. Лучше использовать простые слова, понятные рядовому пользователю, избегать излишнего канцелярита.

Например, вместо "Данный товар отсутствует на складе" можно вывести "Нет остатка". Вместо "Операция выполнена успешно" – просто "Сохранено".

В уведомлениях об ошибках – писать, что случилось и что делать: "Не удалось напечатать чек. Проверьте подключение принтера." – чтобы пользователь знал, как реагировать.

Онбординг (введение):

Для новых бизнесов можно реализовать мастера первичной настройки: сразу после регистрации аккаунта администратору предлагается пройти шаги: заполнить информацию о компании (название, налоговые данные), добавить первый магазин (адрес), добавить пару товаров (чтобы понять как), создать пользователя-кассира. Это поможет быстрее начать (в духе "Быстрый старт – понятный интерфейс, помощь в настройке"
moysklad.uz
).

Можно включить ссылки на видео-уроки или поддержку прямо в интерфейсе (например, раздел "Помощь").

Производительность UI:

Используем lazy loading (ленивую загрузку) модулей – Next.js нам поможет (разделение по страницам). POS – сразу грузит всё нужное, но можем выкинуть неиспользуемые части.

Виртуализация списков, мемоизация компонентов – чтобы интерфейс не фризил на больших объёмах.

Проверяем, чтобы никаких дорогих операций в основном потоке Electron не было (все тяжелое – либо в web worker, либо на бэкенд).

Постоянство данных:

Если пользователь что-то вводил в форму и закрыл случайно – можем предусмотреть предупреждение "Вы уверены? Данные не сохранены." (особенно в веб-админке).

Автосохранение черновиков: например, если заполняли накладную и вдруг обновили страницу – можно сохранять черновик документа в локальное хранилище.

Визуальное соответствие платформе:

На Windows приложение может вписываться в окружение: использовать системные диалоги для выбора принтера, например. Но в целом, кастомный дизайн, унифицированный между веб и desktop.

Обратная связь от пользователей:

В продукт можно встроить механизм отправки отзывов/репортов (например, форма "Сообщить об ошибке/предложить идею"). На старте можно собирать эту инфу для улучшений.

Также можно анонимно трекать взаимодействия (с согласия) – какие функции наиболее используются, где пользователи проводят больше времени – чтобы улучшать UX