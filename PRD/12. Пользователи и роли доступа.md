Пользователи и роли доступа

Ролевая модель (RBAC): Доступ к функционалу определяется ролями пользователей. В MVP достаточно предусмотреть базовые роли (зашитые в системе), с возможностью добавлять новые при необходимости:

Администратор – обычно это владелец бизнеса или ИТ-администратор. Имеет полный доступ ко всем данным своего бизнеса. Может добавлять/удалять пользователей, менять настройки системы, видеть и редактировать все справочники, просматривать все отчёты, финансовые данные.

Управляющий/Менеджер – роль для директора магазина или операционного менеджера. Может видеть продажи и остатки своего магазина (или всех магазинов, если указано), управлять товарным каталогом, оформлять приход/списание товаров, видеть отчёты по своему магазину, просматривать данные сотрудников своего магазина. Не имеет доступа к настройкам бизнеса (оплате подписки, например, если такое будет) и, возможно, к конфиденциальным финансовым отчетам всего бизнеса.

Кассир/Продавец – минимальные права: работа с POS (оформление продаж, возвратов), открытие/закрытие смены. Не имеет доступа к разделам справочников, к отчётам (кроме своих продаж за смену, возможно), к финансовой информации. Может видеть только свой интерфейс кассы и, например, историю своих чеков.

Кладовщик – роль для сотрудника склада/завсклада. Может создавать приходные накладные, инвентаризации, перемещения. Видит остатки. Не имеет доступа к продажам и финансам. (В маленьком магазине эта роль может совмещаться с менеджером.)

Бухгалтер – (опционально в будущем) если подключится бухгалтер, можно дать роль с просмотром всех документов, формированием отчетов, но без права оформлять продажи или изменять настройки. В MVP можно обойтись без отдельной роли бухгалтера, т.к. владелец или менеджер сам просматривает финансы.

Гибкость: Роли реализуются через таблицу прав (permissions). Для MVP достаточно зафиксировать разрешения, но кодом заложим, что новые роли можно добавить (например, в БД таблица Roles, Permissions, UserRoles, чтобы потом через интерфейс настраивать). Пока UI для кастомизации прав может не быть, но архитектурно – RBAC, не hardcode.

Разделение по магазинам: Пользователю можно назначить, к каким магазинам у него доступ. Например, управляющий может видеть 1 магазин из 5. Кассир обычно привязан к конкретному магазину (и, возможно, к конкретной кассе, хотя кассир может сесть за любую кассу своего магазина).

Аутентификация: Используем современный подход Auth - например, Auth.js или сервис Clerk. Авторизация (проверка прав) – на сервере (через NestJS Guards, Middleware) и дублируется на клиенте для условного рендера элементов UI.

Сессии – JWT токены, в которых зашит tenant_id и роль/права. Это будет основой для бекенда, чтобы по каждому запросу знать, кто и от какого бизнеса обращается.

2FA: Для безопасности можно включить опциональную двухфакторную аутентификацию для важных аккаунтов (через приложение аутентификации). В MVP – не обязательное требование, но хорошо бы иметь возможность, т.к. финансовые данные важны.

Audit Log: Как упомянуто, система ведёт аудит: важные действия (создание/удаление пользователей, изменение прав, изменение настроек системы, удаление документов, крупные возвраты) логируются с указанием пользователя, времени, и доступно администратору в разделе "Журнал действий". Это повышает доверие и безопасность.

Пароли и безопасность: Требовать надёжные пароли при регистрации пользователей. Возможность сброса пароля (email/SMS отправка ссылки). Так как система SaaS, обеспечение безопасного хранения (хеширование паролей, защита от brute force – лимиты попыток).

UI доступа:

Администратор через веб-интерфейс имеет раздел "Пользователи", где может приглашать новых пользователей (например, по email), назначать им роль и магазин. Также можно временно блокировать пользователя (уволился сотрудник – блокируем доступ).

Для простоты, можно объединить понятия сотрудник и пользователь системы. Каждый сотрудник, который использует систему, имеет логин. Если есть сотрудники, которые не работают в системе (например, грузчики), их можно не заносить.

При входе пользователь выбирает, возможно, магазин (если у него доступ к нескольким магазинам и он запускает POS, важно выбрать нужный контекст).

Многофакторность контекста: Убедиться, что tenant_id всегда присутствует во всех ключевых запросах. Это решается автоматически, если JWT содержит и backend фильтрует.

Возможность расширения: Добавление новых прав (например, право "просмотр себестоимости" – может быть только у админа, кассирам не показывать себестоимость товаров). На будущее – гибкая матрица разрешений, но MVP минимально